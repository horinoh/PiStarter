CONST #X=0:CONST #Y=1:CONST #Z=2:CONST #W=3
CONST #00= 0:CONST #01= 1:CONST #02= 2:CONST #03= 3
CONST #10= 4:CONST #11= 5:CONST #12= 6:CONST #13= 7
CONST #20= 8:CONST #21= 9:CONST #22=10:CONST #23=11
CONST #30=12:CONST #31=13:CONST #32=14:CONST #33=15
CONST #EPSILON=0.0001

COMMON DEF FRAC(X) RETURN X=FLOOR(X) END

COMMON DEF DOT(L[],R[])
 VAR O[LEN(L)]
 ARYOP #AOPMUL,O,L,R
 VAR SUM=0
 FOR I=0 TO LEN(O)-1
  SUM=SUM+O[I]
 NEXT
 RETURN SUM
END

COMMON DEF NORMALIZE O[],V[]
 VAR SQ=DOT(V,V)
 IF SQ>#EPSILON THEN
  ARYOP #AOPDIV,O,V,SQR(SQ)
 ENDIF
END

COMMON DEF CROSS O[],L[],R[]
 O[#X]=L[#Y]*R[#Z]-L[#Z]*R[#Y]
 O[#Y]=L[#Z]*R[#X]-L[#X]*R[#Z]
 O[#Z]=L[#X]*R[#Y]-L[#Y]*R[#X]
END

COMMON DEF DETERMINANT22(M[])
 RETURN M[0,0]*M[1,1]-M[1,0]*M[0,1]
END

COMMON DEF INVERSE22 O[],M[],DET
 O[0,0]= M[1,1]:O[0,1]=-M[0,1]
 O[1,0]=-M[1,0]:O[1,1]= M[0,0]
 ARYOP #AOPDIV,O,O,DET
END