OPTION STRICT

'LOAD "../MATH/MATH.PRG",1:EXEC 1
LOAD "PRG1:../MATH/MATH.PRG":EXEC 1

'LOAD "RENDER.PRG",2:EXEC 2
LOAD "PRG2:RENDER.PRG":EXEC 2

DEF MAIN
 ACLS

 'DEFAULT == 640X360
 'XSCREEN 1280,720

 GRP_DRAW_TRIANGLES GRP_POLY_PAGE(),GRP_POLY_WIDTH(),GRP_POLY_HEIGHT(),GRP_POLY_MARGIN(),RGB(127,127,127)
 'GPAGE GRP_POLY_PAGE(),0
 'SAVE "GRP3:TRI.PNG"

 SPPOLY_SETUP

 GPAGE 0,0

'VAR M%=2,N%=2
'VAR M%=4,N%=4
VAR M%=8,N%=8
'VAR M%=16,N%=16
 VAR IB%[0]
 SPPOLY_INDEX_BUFFER IB%,M%,N%
 '?"IB="
 'VAR I%:FOR I%=0 TO LEN(IB%)-1 ?IB%[I%] NEXT 

 'VAR FUNC$="SPPOLY_PLANE"
 'VAR FUNC$="SPPOLY_SPHERE"
  VAR FUNC$="SPPOLY_TORUS"
 'VAR FUNC$="SPPOLY_CONE"
 'VAR FUNC$="SPPOLY_PILLOW"
 'VAR FUNC$="SPPOLY_SNAIL"
 VAR VB[0]
 SPPOLY_VERTEX_BUFFER VB,M%,N%,FUNC$
 'VAR I%:FOR I%=0 TO LEN(VB)-1 STEP 3 GPSET VB[I%]*100+320,VB[I%+1]*100+180,#WHITE NEXT

 VAR NB[0]
 SPPOLY_NORMAL_BUFFER NB,M%,N%,FUNC$
 '?"NB="
 'VAR I%:FOR I%=0 TO LEN(NB)-1 ?NB[I%] NEXT 

 VAR ANG=0
 WHILE #TRUE
  VAR WLD[4,4]'=[1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1]
  WLD[0,0]=1:WLD[0,1]=0:WLD[0,2]=0:WLD[0,3]=0
  WLD[1,0]=0:WLD[1,1]=1:WLD[1,2]=0:WLD[1,3]=0
  WLD[2,0]=0:WLD[2,1]=0:WLD[2,2]=1:WLD[2,3]=0
  WLD[3,0]=0:WLD[3,1]=0:WLD[3,2]=0:WLD[3,3]=1

  ANG=ANG+15:WHILE ANG>360 ANG=ANG-360 WEND
  '?ANG
  VAR ROT[4,4]
  ROTATEZ4 ROT,RAD(ANG)

  VAR SCL[4,4]
  VAR SCV[3]'=[100,100,1]
  SCV[0]=100:SCV[1]=100:SCV[2]=1
  SCALE4 SCL,SCV
 
  'MULTIPLY4 WLD,SCL,ROT

  VAR TR[3]'=[320,180,0]
  TR[0]=0:TR[1]=0:TR[2]=1
  TRANSLATE WLD,TR

  VAR MTX[4,4]

  VAR VIW[4,4]
  VAR POS[3]'=[0,0,-10]
  POS[0]=0:POS[1]=0:POS[2]=-10
  VAR TAG[3]'=[0,0,0]
  TAG[0]=0:TAG[1]=0:TAG[2]=0
  VAR UP[3]'=[0,1,0]
  UP[0]=0:UP[1]=1:UP[2]=0
  LOOKAT VIW,POS,TAG,UP
  MULTIPLY4 MTX,WLD,VIW

  VAR PRJ[4,4]
  'PERSPECTIVE PRJ,0.16*#PI,16.0/9.0,0.1,100
  PERSPECTIVE PRJ,0.16*PI(),16.0/9.0,0.1,100
  MULTIPLY4 MTX,MTX,PRJ

  VAR VPT[4,4]
  VIEWPORT VPT,0,0,640,360,0,1
  'MULTIPLY4 MTX,MTX,VPT
  MULTIPLY4 MTX,WLD,VPT

  VAR VBT[0]
  SPPOLY_TRANSFORM4 VBT,VB,MTX
  VAR NBT[0]
  SPPOLY_TRANSFORM3 NBT,NB,ROT

  SPPOLY_DRAW_INDEXED IB%,VBT,NBT

  VSYNC
  GCLS #BLUE
  SPPOLY_CLEAR
  CALL SPRITE

  'BREAK
 WEND

END

MAIN

